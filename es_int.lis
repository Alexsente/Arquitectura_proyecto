00000000                                     1  * Inicializa el SP y el PC
00000000                                     2          ORG     $0
00000000  00008000                           3          DC.L    $8000           *Pila
00000004  0000274A                           4          DC.L    INICIO          *PC
00000400                                     5          ORG     $400
00000400                                     6  
00000400                                     7  	*Buffers
00000400                                     8  BUS_RBA:DS.B 2002
00000BD2                                     9  BUS_RBB:DS.B 2002
000013A4                                    10  BUS_TBA:DS.B 2002
00001B76                                    11  BUS_TBB:DS.B 2002
00002348                                    12  
00002348                                    13  	*Punteros
00002348  00000000                          14  RBA_IN_PUNT: DC.L 0
0000234C  00000000                          15  RBA_FIN_PUNT:DC.L 0
00002350  00000000                          16  RBA_EXT_PUNT:DC.L 0
00002354  00000000                          17  RBA_INT_PUNT:DC.L 0
00002358  00000000                          18  RBB_IN_PUNT: DC.L 0
0000235C  00000000                          19  RBB_FIN_PUNT:DC.L 0
00002360  00000000                          20  RBB_EXT_PUNT:DC.L 0
00002364  00000000                          21  RBB_INT_PUNT:DC.L 0
00002368  00000000                          22  TBA_IN_PUNT: DC.L 0
0000236C  00000000                          23  TBA_FIN_PUNT:DC.L 0
00002370  00000000                          24  TBA_EXT_PUNT:DC.L 0
00002374  00000000                          25  TBA_INT_PUNT:DC.L 0
00002378  00000000                          26  TBB_IN_PUNT: DC.L 0
0000237C  00000000                          27  TBB_FIN_PUNT:DC.L 0
00002380  00000000                          28  TBB_EXT_PUNT:DC.L 0
00002384  00000000                          29  TBB_INT_PUNT:DC.L 0
00002388                                    30  
00002388                                    31  
00002388                                    32  * Definicion de equivalencias
00002388                                    33  
00002388  =00EFFC01                         34  MR1A    EQU     $effc01       * de modo A (escritura)
00002388  =00EFFC01                         35  MR2A    EQU     $effc01       * de modo A (2 escritura)
00002388  =00EFFC03                         36  SRA     EQU     $effc03       * de estado A (lectura)
00002388  =00EFFC03                         37  CSRA    EQU     $effc03       * de seleccion de reloj A (escritura)
00002388  =00EFFC05                         38  CRA     EQU     $effc05       * de control A (escritura)
00002388  =00EFFC07                         39  TBA     EQU     $effc07       * buffer transmision A (escritura)
00002388  =00EFFC07                         40  RBA     EQU     $effc07       * buffer recepcion A  (lectura)
00002388  =00EFFC17                         41  TBB     EQU     $effc17       * buffer trasmisión B
00002388  =00EFFC17                         42  RBB     EQU     $effc17       * buffer recepción B
00002388  =00EFFC09                         43  ACR     EQU     $effc09       * de control auxiliar
00002388  =00EFFC0B                         44  IMR     EQU     $effc0B       * de mascara de interrupcion A (escritura)
00002388  =00EFFC0B                         45  ISR     EQU     $effc0B       * de estado de interrupcion A (lectura)
00002388                                    46  
00002388                                    47  *INIT
00002388                                    48  INIT:
00002388  21FC 00000400 2348                49  	MOVE.L #BUS_RBA,RBA_IN_PUNT
00002390  21FC 00000400 2350                50  	MOVE.L #BUS_RBA,RBA_EXT_PUNT
00002398  21FC 00000400 2354                51  	MOVE.L #BUS_RBA,RBA_INT_PUNT
000023A0  21FC 00000400 234C                52  	MOVE.L #BUS_RBA,RBA_FIN_PUNT
000023A8  06B8 000007CF 234C                53  	ADD.L  #1999,RBA_FIN_PUNT
000023B0  21FC 00000BD2 2358                54  	MOVE.L #BUS_RBB,RBB_IN_PUNT
000023B8  21FC 00000BD2 2360                55  	MOVE.L #BUS_RBB,RBB_EXT_PUNT
000023C0  21FC 00000BD2 2364                56  	MOVE.L #BUS_RBB,RBB_INT_PUNT
000023C8  21FC 00000BD2 235C                57  	MOVE.L #BUS_RBB,RBB_FIN_PUNT
000023D0  06B8 000007CF 235C                58  	ADD.L  #1999,RBB_FIN_PUNT
000023D8  21FC 000013A4 2368                59  	MOVE.L #BUS_TBA,TBA_IN_PUNT
000023E0  21FC 000013A4 2370                60  	MOVE.L #BUS_TBA,TBA_EXT_PUNT
000023E8  21FC 000013A4 2374                61  	MOVE.L #BUS_TBA,TBA_INT_PUNT
000023F0  21FC 000013A4 236C                62  	MOVE.L #BUS_TBA,TBA_FIN_PUNT
000023F8  06B8 000007CF 236C                63  	ADD.L  #1999,TBA_FIN_PUNT
00002400  21FC 00001B76 2378                64  	MOVE.L #BUS_TBB,TBB_IN_PUNT
00002408  21FC 00001B76 2380                65  	MOVE.L #BUS_TBB,TBB_EXT_PUNT
00002410  21FC 00001B76 2384                66  	MOVE.L #BUS_TBB,TBB_INT_PUNT
00002418  21FC 00001B76 237C                67  	MOVE.L #BUS_TBB,TBB_FIN_PUNT
00002420  06B8 000007CF 237C                68  	ADD.L  #1999,TBB_FIN_PUNT
00002428  4E75                              69  	RTS
0000242A                                    70  
0000242A                                    71    *********************LEECAR**********************
0000242A                                    72  
0000242A                                    73    LEECAR:
0000242A  0800 0000                         74      BTST    #0,D0
0000242E                                    75      *BEQ LA_LINEA
0000242E                                    76  
0000242E                                    77  LB_LINEA:
0000242E  B07C 0001                         78       CMP #$00000001,D0
00002432                                    79      * BEQ LB_REC
00002432                                    80  
00002432                                    81  LB_TRANS:
00002432  2478 2378                         82       MOVE.L TBB_IN_PUNT,A2
00002436  2678 2380                         83       MOVE.L TBB_EXT_PUNT,A3
0000243A  2878 2384                         84       MOVE.L TBB_INT_PUNT,A4
0000243E  2A78 237C                         85       MOVE.L TBB_FIN_PUNT,A5
00002442  B8CB                              86       CMP  A3,A4    * E=I?
00002444  6700 0104                         87       BEQ VACIO     * E= I, entonces buffer vacio
00002448  528D                              88       ADD.L #1,A5
0000244A  BACB                              89       CMP A3,A5     * E = F+1?
0000244C  538D                              90       SUB.L #1,A5  *Se restablece F a sus posicion original
0000244E  6700 000C                         91       BEQ TBB_RESET
00002452  101B                              92       MOVE.B  (A3)+,D0
00002454  21CB 2380                         93       MOVE.L  A3,TBB_EXT_PUNT
00002458  6000 00F2                         94       BRA FIN_LEECAR
0000245C                                    95    TBB_RESET:
0000245C  B8CA                              96       CMP A2,A4  *I=P?
0000245E  6600 000C                         97       BNE TBB_I_NO_P
00002462  1012                              98       MOVE.B   (A2),D0
00002464  21CA 2380                         99       MOVE.L  A2,TBB_EXT_PUNT
00002468  6000 00E2                        100       BRA FIN_LEECAR
0000246C                                   101  TBB_I_NO_P:
0000246C  101A                             102       MOVE.B  (A2)+,D0
0000246E  21CA 2380                        103       MOVE.L  A2,TBB_EXT_PUNT
00002472  6000 00D8                        104       BRA FIN_LEECAR
00002476                                   105  
00002476                                   106  LB_REC:
00002476  2478 2358                        107      MOVE.L RBB_IN_PUNT,A2
0000247A  2678 2360                        108      MOVE.L RBB_EXT_PUNT,A3
0000247E  2878 2364                        109      MOVE.L RBB_INT_PUNT,A4
00002482  2A78 235C                        110      MOVE.L RBB_FIN_PUNT,A5
00002486  B8CB                             111      CMP  A3,A4    * E=I?
00002488  6700 00C0                        112      BEQ VACIO     * E= I, entonces buffer vacio
0000248C  528D                             113      ADD.L #1,A5
0000248E  BACB                             114      CMP A3,A5     * E = F+1?
00002490  538D                             115      SUB.L #1,A5  *Se restablece F a sus posicion original
00002492  6700 000C                        116      BEQ RBB_RESET
00002496  101B                             117      MOVE.B  (A3)+,D0
00002498  21CB 2360                        118      MOVE.L  A3,RBB_EXT_PUNT
0000249C  6000 00AE                        119      BRA FIN_LEECAR
000024A0                                   120  RBB_RESET:
000024A0  B8CA                             121      CMP A2,A4  *I=P?
000024A2  6600 000C                        122      BNE RBB_I_NO_P
000024A6  1012                             123      MOVE.B   (A2),D0
000024A8  21CA 2360                        124      MOVE.L  A2,RBB_EXT_PUNT
000024AC  6000 009E                        125      BRA FIN_LEECAR
000024B0                                   126  RBB_I_NO_P:
000024B0  101A                             127      MOVE.B  (A2)+,D0
000024B2  21CA 2360                        128      MOVE.L  A2,RBB_EXT_PUNT
000024B6  6000 0094                        129      BRA FIN_LEECAR
000024BA                                   130  
000024BA                                   131  LA_LINEA:
000024BA  B07C 0000                        132      CMP #$00000000,D0
000024BE  6700 0046                        133      BEQ LA_REC
000024C2                                   134  
000024C2                                   135  LA_TRANS:
000024C2  2478 2368                        136      MOVE.L TBA_IN_PUNT,A2
000024C6  2678 2370                        137      MOVE.L TBA_EXT_PUNT,A3
000024CA  2878 2374                        138      MOVE.L TBA_INT_PUNT,A4
000024CE  2A78 236C                        139      MOVE.L TBA_FIN_PUNT,A5
000024D2  B8CB                             140      CMP  A3,A4    * E=I?
000024D4  6700 0074                        141      BEQ VACIO     * E= I, entonces buffer vacio
000024D8  528D                             142      ADD.L #1,A5
000024DA  BACB                             143      CMP A3,A5     * E = F+1?
000024DC  538D                             144      SUB.L #1,A5  *Se restablece F a sus posicion original
000024DE  6700 000C                        145      BEQ TBA_RESET
000024E2  101B                             146      MOVE.B  (A3)+,D0
000024E4  21CB 2370                        147      MOVE.L  A3,TBA_EXT_PUNT
000024E8  6000 0062                        148      BRA FIN_LEECAR
000024EC                                   149  TBA_RESET:
000024EC  B8CA                             150      CMP A2,A4  *I=P?
000024EE  6600 000C                        151      BNE TBA_I_NO_P
000024F2  1012                             152      MOVE.B  (A2),D0
000024F4  21CA 2370                        153      MOVE.L  A2,TBA_EXT_PUNT
000024F8  6000 0052                        154      BRA FIN_LEECAR
000024FC                                   155  TBA_I_NO_P:
000024FC  101A                             156      MOVE.B  (A2)+,D0
000024FE  21CA 2370                        157      MOVE.L  A2,TBA_EXT_PUNT
00002502  6000 0048                        158      BRA FIN_LEECAR
00002506                                   159  
00002506                                   160  LA_REC:
00002506  2478 2348                        161      MOVE.L RBA_IN_PUNT,A2
0000250A  2678 2350                        162      MOVE.L RBA_EXT_PUNT,A3
0000250E  2878 2354                        163      MOVE.L RBA_INT_PUNT,A4
00002512  2A78 234C                        164      MOVE.L RBA_FIN_PUNT,A5
00002516  B8CB                             165      CMP  A3,A4    * E=I?
00002518  6700 0030                        166      BEQ VACIO     * E= I, entonces buffer vacio
0000251C  528D                             167      ADD.L #1,A5
0000251E  BACB                             168      CMP A3,A5     * E = F+1?
00002520  538D                             169      SUB.L #1,A5  *Se restablece F a sus posicion original
00002522  6700 000C                        170      BEQ RBA_RESET
00002526  101B                             171      MOVE.B  (A3)+,D0
00002528  21CB 2350                        172      MOVE.L  A3,RBA_EXT_PUNT
0000252C  6000 001E                        173      BRA FIN_LEECAR
00002530                                   174  RBA_RESET:
00002530  B8CA                             175      CMP A2,A4  *I=P?
00002532  6600 000C                        176      BNE RBA_I_NO_P
00002536  1012                             177      MOVE.B  (A2),D0
00002538  21CA 2350                        178      MOVE.L  A2,RBA_EXT_PUNT
0000253C  6000 000E                        179      BRA FIN_LEECAR
00002540                                   180  RBA_I_NO_P:
00002540  101A                             181      MOVE.B  (A2)+,D0
00002542  21CA 2350                        182      MOVE.L  A2,RBA_EXT_PUNT
00002546  6000 0004                        183      BRA FIN_LEECAR
0000254A                                   184  
0000254A                                   185    VACIO:
0000254A  70FF                             186      MOVE.L #$ffffffff,D0
0000254C  4E75                             187    FIN_LEECAR:RTS
0000254E                                   188  
0000254E                                   189  ********************ESCCAR********************
0000254E                                   190  ESCCAR:
0000254E                                   191  
0000254E  0800 0000                        192      BTST #0,D0
00002552                                   193      *BEQ EA_LINEA
00002552                                   194  
00002552                                   195  EB_LINEA:
00002552                                   196  
00002552  B07C 0001                        197      CMP #$00000001,D0
00002556                                   198      *BEQ ESC_REC_B
00002556                                   199  
00002556                                   200  ESC_TRANS_B:
00002556  2478 2378                        201      MOVE.L TBB_IN_PUNT,A2 *Se mete el puntero de Principio al A2
0000255A  2678 2380                        202      MOVE.L TBB_EXT_PUNT,A3 *Se mete el puntero de E al A3
0000255E  2878 2384                        203      MOVE.L TBB_INT_PUNT,A4 *Se mete el puntero I en A4
00002562  2A78 237C                        204      MOVE.L TBB_FIN_PUNT,A5 *Se mete el puntero FIn en A5
00002566  538B                             205      SUB.L #1,A3  *Se le resta 1 a E
00002568  B9CB                             206      CMP.L A3,A4 * I=E-1?
0000256A  528B                             207      ADD.L #1,A3  *Se restablece el valor de E
0000256C  6700 0128                        208      BEQ LLENO
00002570  528D                             209      ADD.L #1,A5   *Se le añade 1 al puntero de fin
00002572  BBCC                             210      CMP.L A4,A5   *Se comparan los punteros I y F+1
00002574  538D                             211      SUB.L #1,A5   *Se restablece el valor del puntero FIn
00002576  6700 001A                        212      BEQ  TBB_AUX      *Está en la posicion auxiliar
0000257A                                   213  
0000257A                                   214  TBB_NO_AUX:
0000257A  B9CB                             215      CMP.L A3,A4  *Se comparan I y E
0000257C  6C00 000C                        216      BGE TBB_MAYOR
00002580  528C                             217      ADD.L #1,A4
00002582  1881                             218      MOVE.B  D1,(A4)            *Push del registro D1 en el buffer
00002584  21CC 2384                        219      MOVE.L  A4,TBB_INT_PUNT    *Guarda la nueva direcion del puntero
00002588  4E75                             220      RTS
0000258A                                   221  TBB_MAYOR:
0000258A  18C1                             222      MOVE.B  D1,(A4)+           *Push del registro D1 en el buffer
0000258C  21CC 2384                        223      MOVE.L  A4,TBB_INT_PUNT           *Guarda la nueva direcion del puntero
00002590  4E75                             224      RTS
00002592                                   225  
00002592                                   226  TBB_AUX:
00002592  B5CB                             227      CMP.L A3,A2  * E=P?
00002594  6700 0100                        228      BEQ   LLENO
00002598  2878 2378                        229      MOVE.L  TBB_IN_PUNT,A4
0000259C  1881                             230      MOVE.B  D1,(A4)   *Push del registro D1 en el buffer
0000259E  21CC 2384                        231      MOVE.L  A4,TBB_INT_PUNT  *Se Inicializa I con el valor de Principio
000025A2  4E75                             232      RTS
000025A4                                   233  
000025A4                                   234  ESC_REC_B:
000025A4  2878 2364                        235    MOVE.L RBB_INT_PUNT,A4 *Se mete el puntero I en A4
000025A8  2A78 235C                        236    MOVE.L RBB_FIN_PUNT,A5 *Se mete el puntero FIn en A5
000025AC  2678 2360                        237    MOVE.L RBB_EXT_PUNT,A3 *Se mete el puntero de E al A3
000025B0  2478 2358                        238    MOVE.L RBB_IN_PUNT,A2 *Se mete el puntero de Principio al A2
000025B4  538B                             239    SUB.L #1,A3  *Se le resta 1 a E
000025B6  B9CB                             240    CMP.L A3,A4 * I=E-1?
000025B8  528B                             241    ADD.L #1,A3  *Se restablece el valor de E
000025BA  6700 00DA                        242    BEQ LLENO
000025BE  528D                             243    ADD.L #1,A5   *Se le añade 1 al puntero de fin
000025C0  BBCC                             244    CMP.L A4,A5   *Se comparan los punteros I y F+1
000025C2  538D                             245    SUB.L #1,A5   *Se restablece el valor del puntero FIn
000025C4  6700 001A                        246    BEQ  RBB_AUX      *Está en la posicion auxiliar
000025C8                                   247  
000025C8                                   248  RBB_NO_AUX:
000025C8  B9CB                             249    CMP.L A3,A4  *Se comparan I y E
000025CA  6C00 000C                        250    BGE RBB_MAYOR
000025CE  528C                             251    ADD.L #1,A4
000025D0  1881                             252    MOVE.B  D1,(A4)            *Push del registro D1 en el buffer
000025D2  21CC 2364                        253    MOVE.L  A4,RBB_INT_PUNT    *Guarda la nueva direcion del puntero
000025D6  4E75                             254    RTS
000025D8                                   255  RBB_MAYOR:
000025D8  18C1                             256    MOVE.B  D1,(A4)+           *Push del registro D1 en el buffer
000025DA  21CC 2364                        257    MOVE.L  A4,RBB_INT_PUNT           *Guarda la nueva direcion del puntero
000025DE  4E75                             258    RTS
000025E0                                   259  
000025E0                                   260  RBB_AUX:
000025E0  B5CB                             261    CMP.L A3,A2  * E=P?
000025E2  6700 00B2                        262    BEQ   LLENO
000025E6  2878 2358                        263    MOVE.L  RBB_IN_PUNT,A4
000025EA  1881                             264    MOVE.B  D1,(A4)   *Push del registro D1 en el buffer
000025EC  21CC 2364                        265    MOVE.L  A4,RBB_INT_PUNT  *Se Inicializa I con el valor de Principio
000025F0  4E75                             266    RTS
000025F2                                   267  
000025F2                                   268  EA_LINEA:
000025F2  B07C 0000                        269    CMP #$00000000,D0
000025F6  6700 0050                        270    BEQ EA_REC
000025FA                                   271  
000025FA                                   272  EA_TRANS:
000025FA  2878 2374                        273    MOVE.L TBA_INT_PUNT,A4 *Se mete el puntero I en A4
000025FE  2A78 236C                        274    MOVE.L TBA_FIN_PUNT,A5 *Se mete el puntero FIn en A5
00002602  2678 2370                        275    MOVE.L TBA_EXT_PUNT,A3 *Se mete el puntero de E al A3
00002606  2478 2368                        276    MOVE.L TBA_IN_PUNT,A2 *Se mete el puntero de Principio al A2
0000260A  538B                             277    SUB.L #1,A3  *Se le resta 1 a E
0000260C  B9CB                             278    CMP.L A3,A4 * I=E-1?
0000260E  528B                             279    ADD.L #1,A3  *Se restablece el valor de E
00002610  6700 0084                        280    BEQ LLENO
00002614  528D                             281    ADD.L #1,A5   *Se le añade 1 al puntero de fin
00002616  BBCC                             282    CMP.L A4,A5   *Se comparan los punteros I y F+1
00002618  538D                             283    SUB.L #1,A5   *Se restablece el valor del puntero FIn
0000261A  6700 001A                        284    BEQ  TBA_AUX      *Está en la posicion auxiliar
0000261E                                   285  
0000261E                                   286  TBA_NO_AUX:
0000261E  B9CB                             287    CMP.L A3,A4  *Se comparan I y E
00002620  6C00 000C                        288    BGE TBA_MAYOR
00002624  528C                             289    ADD.L #1,A4
00002626  1881                             290    MOVE.B  D1,(A4)            *Push del registro D1 en el buffer
00002628  21CC 2374                        291    MOVE.L  A4,TBA_INT_PUNT    *Guarda la nueva direcion del puntero
0000262C  4E75                             292    RTS
0000262E                                   293  TBA_MAYOR:
0000262E  18C1                             294    MOVE.B  D1,(A4)+           *Push del registro D1 en el buffer
00002630  21CC 2374                        295    MOVE.L  A4,TBA_INT_PUNT           *Guarda la nueva direcion del puntero
00002634  4E75                             296    RTS
00002636                                   297  
00002636                                   298  TBA_AUX:
00002636  B5CB                             299    CMP.L A3,A2  * E=P?
00002638  6700 005C                        300    BEQ   LLENO
0000263C  2878 2368                        301    MOVE.L  TBA_IN_PUNT,A4
00002640  1881                             302    MOVE.B  D1,(A4)   *Push del registro D1 en el buffer
00002642  21CC 2374                        303    MOVE.L  A4,TBA_INT_PUNT  *Se Inicializa I con el valor de Principio
00002646  4E75                             304    RTS
00002648                                   305  
00002648                                   306  EA_REC:
00002648  2878 2354                        307    MOVE.L RBA_INT_PUNT,A4 *Se mete el puntero I en A4
0000264C  2A78 234C                        308    MOVE.L RBA_FIN_PUNT,A5 *Se mete el puntero FIn en A5
00002650  2678 2350                        309    MOVE.L RBA_EXT_PUNT,A3 *Se mete el puntero de E al A3
00002654  2478 2348                        310    MOVE.L RBA_IN_PUNT,A2 *Se mete el puntero de Principio al A2
00002658  538B                             311    SUB.L #1,A3  *Se le resta 1 a E
0000265A  B9CB                             312    CMP.L A3,A4 * I=E-1?
0000265C  528B                             313    ADD.L #1,A3  *Se restablece el valor de E
0000265E  6700 0036                        314    BEQ LLENO
00002662  528D                             315    ADD.L #1,A5   *Se le añade 1 al puntero de fin
00002664  BBCC                             316    CMP.L A4,A5   *Se comparan los punteros I y F+1
00002666  538D                             317    SUB.L #1,A5   *Se restablece el valor del puntero FIn
00002668  6700 001A                        318    BEQ  RBA_AUX      *Está en la posicion auxiliar
0000266C                                   319  
0000266C                                   320  RBA_NO_AUX:
0000266C  B9CB                             321    CMP.L A3,A4  *Se comparan I y E
0000266E  6C00 000C                        322    BGE RBA_MAYOR
00002672  528C                             323    ADD.L #1,A4
00002674  1881                             324    MOVE.B  D1,(A4)            *Push del registro D1 en el buffer
00002676  21CC 2354                        325    MOVE.L  A4,RBA_INT_PUNT    *Guarda la nueva direcion del puntero
0000267A  4E75                             326    RTS
0000267C                                   327  RBA_MAYOR:
0000267C  18C1                             328    MOVE.B  D1,(A4)+           *Push del registro D1 en el buffer
0000267E  21CC 2354                        329    MOVE.L  A4,RBA_INT_PUNT           *Guarda la nueva direcion del puntero
00002682  4E75                             330    RTS
00002684                                   331  
00002684                                   332  RBA_AUX:
00002684  B5CB                             333    CMP.L A3,A2  * E=P?
00002686  6700 000E                        334    BEQ   LLENO
0000268A  2878 2348                        335    MOVE.L  RBA_IN_PUNT,A4
0000268E  1881                             336    MOVE.B  D1,(A4)   *Push del registro D1 en el buffer
00002690  21CC 2354                        337    MOVE.L  A4,RBA_INT_PUNT  *Se Inicializa I con el valor de Principio
00002694  4E75                             338    RTS
00002696                                   339  LLENO:
00002696  70FF                             340      MOVE.L #$ffffffff,D0
00002698  4E75                             341      RTS
0000269A                                   342  
0000269A                                   343  ********************LINEA********************
0000269A                                   344  
0000269A                                   345  LINEA:
0000269A  0800 0000                        346    BTST #0,D0
0000269E                                   347    *BEQ LINEA_A
0000269E                                   348  
0000269E                                   349  LINEA_B:
0000269E  B07C 0001                        350    CMP #$00000001,D0
000026A2                                   351    *BEQ LINEAB_REC
000026A2                                   352  
000026A2                                   353  LINEAB_TRANS:
000026A2  2478 2378                        354    MOVE.L TBB_IN_PUNT,A2
000026A6  2678 2380                        355    MOVE.L TBB_EXT_PUNT,A3 *Se mete el puntero de Principio al A2
000026AA  2878 2384                        356    MOVE.L TBB_INT_PUNT,A4 *Se mete el puntero I en A4
000026AE  2A78 237C                        357    MOVE.L TBB_FIN_PUNT,A5 *Se mete el puntero FIn en A5
000026B2  4280                             358    CLR.L D0 *Contador
000026B4  6000 004C                        359    BRA L_BUCLE
000026B8                                   360  LINEAB_REC:
000026B8  2478 2358                        361    MOVE.L RBB_IN_PUNT,A2
000026BC  2678 2360                        362    MOVE.L RBB_EXT_PUNT,A3 *Se mete el puntero de Principio al A2
000026C0  2878 2364                        363    MOVE.L RBB_INT_PUNT,A4 *Se mete el puntero I en A4
000026C4  2A78 235C                        364    MOVE.L RBB_FIN_PUNT,A5 *Se mete el puntero FIn en A5
000026C8  4280                             365    CLR.L D0 *Contador
000026CA  6000 0036                        366    BRA L_BUCLE
000026CE                                   367  LINEA_A:
000026CE  B07C 0000                        368    CMP #$00000000,D0
000026D2  6700 0018                        369    BEQ LINEAA_REC
000026D6                                   370  
000026D6                                   371  LINEAA_TRANS:
000026D6  2478 2368                        372    MOVE.L TBA_IN_PUNT,A2
000026DA  2678 2370                        373    MOVE.L TBA_EXT_PUNT,A3 *Se mete el puntero de Principio al A2
000026DE  2878 2374                        374    MOVE.L TBA_INT_PUNT,A4 *Se mete el puntero I en A4
000026E2  2A78 236C                        375    MOVE.L TBA_FIN_PUNT,A5 *Se mete el puntero FIn en A5
000026E6  4280                             376    CLR.L D0 *Contador
000026E8  6000 0018                        377    BRA L_BUCLE
000026EC                                   378  LINEAA_REC:
000026EC  2478 2348                        379    MOVE.L RBA_IN_PUNT,A2
000026F0  2678 2350                        380    MOVE.L RBA_EXT_PUNT,A3 *Se mete el puntero de Principio al A2
000026F4  2878 2354                        381    MOVE.L RBA_INT_PUNT,A4 *Se mete el puntero I en A4
000026F8  2A78 234C                        382    MOVE.L RBA_FIN_PUNT,A5 *Se mete el puntero FIn en A5
000026FC  4280                             383    CLR.L D0 *Contador
000026FE  6000 0002                        384    BRA L_BUCLE
00002702                                   385  L_BUCLE:
00002702  4281                             386     CLR.L D1
00002704  5280                             387     ADD.L #1,D0 *Aumenta el contador
00002706  1213                             388     MOVE.B (A3),D1 *POP de E
00002708  B27C 000D                        389     CMP #13,D1 *D1=13?
0000270C  6700 0034                        390     BEQ F_LINEA  *Si D1=13, SE acaba la linea
00002710  BACB                             391     CMP A3,A5 *E=F?
00002712  6700 0010                        392     BEQ FIN_LINEA *Si E=F, esta al final de la linea
00002716  B6CC                             393     CMP A4,A3 *I=E?
00002718  6700 0006                        394     BEQ L_VACIO *Si I=E, vacio
0000271C  528B                             395     ADD.L #1,A3
0000271E  60E2                             396     BRA L_BUCLE
00002720                                   397  L_VACIO:
00002720  4280                             398    CLR.L D0 *Se pone el contador a 0
00002722  4E75                             399    RTS
00002724                                   400  FIN_LINEA:
00002724  121B                             401    MOVE.B (A3)+,D1 *POP del buffer
00002726  B27C 000D                        402    CMP #13,D1 *D1=13?
0000272A  6700 0016                        403    BEQ F_LINEA *Fin de la linea
0000272E  528D                             404    ADD.L #1,A5
00002730  BACC                             405    CMP A4,A5
00002732  538D                             406    SUB.L #1,A5
00002734  6600 0008                        407    BNE L_RESET
00002738  4280                             408    CLR.L D0 *D1!=13, no es una linea, por tanto contador=0
0000273A  6000 0006                        409    BRA F_LINEA
0000273E                                   410  L_RESET:
0000273E  264A                             411    MOVE.L A2,A3
00002740  60C0                             412    BRA L_BUCLE
00002742  4E75                             413  F_LINEA: RTS
00002744                                   414  
00002744                                   415  *PRINT
00002744  4E75                             416  PRINT:RTS
00002746                                   417  *SCAN
00002746  4E75                             418  SCAN:RTS
00002748                                   419  
00002748                                   420  *RTI
00002748  4E75                             421  RTI:RTS
0000274A                                   422  
0000274A                                   423  *Pruebas
0000274A                                   424  
0000274A                                   425  *Programa Principal
0000274A                                   426  INICIO:
0000274A  6100 FC3C                        427     BSR INIT
0000274E  4281                             428     CLR.L D1
00002750  4283                             429     CLR.L D3
00002752                                   430  B1:
00002752  5281                             431     ADD.L #1,D1
00002754  5283                             432     ADD.L #1,D3
00002756  B27C 000A                        433     CMP  #10,D1
0000275A  6600 0004                        434     BNE CON_1
0000275E  4281                             435     CLR.L D1
00002760                                   436  CON_1:
00002760  6100 FDEC                        437     BSR ESCCAR
00002764  B67C 05DC                        438     CMP #1500,D3
00002768  66E8                             439     BNE B1
0000276A                                   440  
0000276A  4283                             441     CLR.L D3
0000276C                                   442  
0000276C                                   443  B2:
0000276C  5283                             444    ADD.L #1,D3
0000276E  6100 FCBA                        445    BSR LEECAR
00002772  B67C 05DC                        446    CMP #1500,D3
00002776  66F4                             447    BNE B2
00002778                                   448  
00002778  4283                             449    CLR.L D3
0000277A                                   450  
0000277A                                   451  B3:
0000277A  5281                             452    ADD.L #1,D1
0000277C  5283                             453    ADD.L #1,D3
0000277E  B27C 000A                        454    CMP  #10,D1
00002782  6600 0004                        455    BNE CON_3
00002786  4281                             456    CLR.L D1
00002788                                   457  CON_3:
00002788  6100 FDC4                        458    BSR ESCCAR
0000278C  B67C 03E7                        459    CMP #999,D3
00002790  66E8                             460    BNE B3
00002792                                   461  
00002792  720D                             462    MOVE.L #13,D1
00002794  6100 FDB8                        463    BSR ESCCAR
00002798  6100 FF00                        464    BSR LINEA
0000279C  4848                             465     BREAK

No errors detected
No warnings generated
