00000000                                     1  * Inicializa el SP y el PC
00000000                                     2          ORG     $0
00000000  00008000                           3          DC.L    $8000           *Pila
00000004  0000066C                           4          DC.L    INICIO          *PC
00000400                                     5          ORG     $400
00000400                                     6  
00000400                                     7  	*Buffers
00000400                                     8  BUS_RBA:DS.B 10
0000040A                                     9  BUS_RBB:DS.B 10
00000414                                    10  BUS_TBA:DS.B 10
0000041E                                    11  BUS_TBB:DS.B 10
00000428                                    12  
00000428                                    13  	*Punteros
00000428  00000000                          14  RBA_IN_PUNT: DC.L 0
0000042C  00000000                          15  RBA_FIN_PUNT:DC.L 0
00000430  00000000                          16  RBA_EXT_PUNT:DC.L 0
00000434  00000000                          17  RBA_INT_PUNT:DC.L 0
00000438  00000000                          18  RBB_IN_PUNT: DC.L 0
0000043C  00000000                          19  RBB_FIN_PUNT:DC.L 0
00000440  00000000                          20  RBB_EXT_PUNT:DC.L 0
00000444  00000000                          21  RBB_INT_PUNT:DC.L 0
00000448  00000000                          22  TBA_IN_PUNT: DC.L 0
0000044C  00000000                          23  TBA_FIN_PUNT:DC.L 0
00000450  00000000                          24  TBA_EXT_PUNT:DC.L 0
00000454  00000000                          25  TBA_INT_PUNT:DC.L 0
00000458  00000000                          26  TBB_IN_PUNT: DC.L 0
0000045C  00000000                          27  TBB_FIN_PUNT:DC.L 0
00000460  00000000                          28  TBB_EXT_PUNT:DC.L 0
00000464  00000000                          29  TBB_INT_PUNT:DC.L 0
00000468                                    30  
00000468                                    31  
00000468                                    32  
00000468                                    33  * Definicion de equivalencias
00000468                                    34  
00000468  =00EFFC01                         35  MR1A    EQU     $effc01       * de modo A (escritura)
00000468  =00EFFC01                         36  MR2A    EQU     $effc01       * de modo A (2 escritura)
00000468  =00EFFC03                         37  SRA     EQU     $effc03       * de estado A (lectura)
00000468  =00EFFC03                         38  CSRA    EQU     $effc03       * de seleccion de reloj A (escritura)
00000468  =00EFFC05                         39  CRA     EQU     $effc05       * de control A (escritura)
00000468  =00EFFC07                         40  TBA     EQU     $effc07       * buffer transmision A (escritura)
00000468  =00EFFC07                         41  RBA     EQU     $effc07       * buffer recepcion A  (lectura)
00000468  =00EFFC17                         42  TBB     EQU     $effc17       * buffer trasmisión B
00000468  =00EFFC17                         43  RBB     EQU     $effc17       * buffer recepción B
00000468  =00EFFC09                         44  ACR     EQU     $effc09       * de control auxiliar
00000468  =00EFFC0B                         45  IMR     EQU     $effc0B       * de mascara de interrupcion A (escritura)
00000468  =00EFFC0B                         46  ISR     EQU     $effc0B       * de estado de interrupcion A (lectura)
00000468                                    47  
00000468                                    48  *INIT
00000468                                    49  INIT:
00000468  21FC 00000400 0428                50  	MOVE.L #BUS_RBA,RBA_IN_PUNT
00000470  21FC 00000400 0430                51  	MOVE.L #BUS_RBA,RBA_EXT_PUNT
00000478  21FC 00000400 0434                52  	MOVE.L #BUS_RBA,RBA_INT_PUNT
00000480  21FC 00000400 042C                53  	MOVE.L #BUS_RBA,RBA_FIN_PUNT
00000488  50B8 042C                         54  	ADD.L  #$8,RBA_FIN_PUNT
0000048C  21FC 0000040A 0438                55  	MOVE.L #BUS_RBB,RBB_IN_PUNT
00000494  21FC 0000040A 0440                56  	MOVE.L #BUS_RBB,RBB_EXT_PUNT
0000049C  21FC 0000040A 0444                57  	MOVE.L #BUS_RBB,RBB_INT_PUNT
000004A4  21FC 0000040A 043C                58  	MOVE.L #BUS_RBB,RBB_FIN_PUNT
000004AC  50B8 043C                         59  	ADD.L  #$8,RBB_FIN_PUNT
000004B0  21FC 00000414 0448                60  	MOVE.L #BUS_TBA,TBA_IN_PUNT
000004B8  21FC 00000414 0450                61  	MOVE.L #BUS_TBA,TBA_EXT_PUNT
000004C0  21FC 00000414 0454                62  	MOVE.L #BUS_TBA,TBA_INT_PUNT
000004C8  21FC 00000414 044C                63  	MOVE.L #BUS_TBA,TBA_FIN_PUNT
000004D0  5EB8 044C                         64  	ADD.L  #$7,TBA_FIN_PUNT
000004D4  21FC 0000041E 0458                65  	MOVE.L #BUS_TBB,TBB_IN_PUNT
000004DC  21FC 0000041E 0460                66  	MOVE.L #BUS_TBB,TBB_EXT_PUNT
000004E4  21FC 0000041E 0464                67  	MOVE.L #BUS_TBB,TBB_INT_PUNT
000004EC  21FC 0000041E 045C                68  	MOVE.L #BUS_TBB,TBB_FIN_PUNT
000004F4  50B8 045C                         69  	ADD.L  #$8,TBB_FIN_PUNT
000004F8  4E75                              70  	RTS
000004FA                                    71  
000004FA                                    72    *********************LEECAR**********************
000004FA                                    73  
000004FA                                    74    LEECAR:
000004FA  0800 0000                         75      BTST    #0,D0
000004FE  6700 007E                         76      BEQ LINEA_A
00000502                                    77  
00000502                                    78    LINEA_B:
00000502  B07C 0001                         79      CMP #$00000001,D0
00000506  6700 003C                         80      BEQ REC_B
0000050A                                    81    TRANS_B:
0000050A  2878 0464                         82      MOVE.L TBB_INT_PUNT,A4
0000050E  2678 0460                         83      MOVE.L TBB_EXT_PUNT,A3
00000512  B8CB                              84      CMP  A3,A4
00000514  6700 00D8                         85      BEQ VACIO
00000518  2878 045C                         86      MOVE.L TBB_FIN_PUNT,A4
0000051C  528C                              87      ADD.L #1,A4
0000051E  B8CB                              88      CMP A3,A4
00000520  6700 0010                         89      BEQ TBB_RESET
00000524  2A78 0460                         90      MOVE.L  TBB_EXT_PUNT,A5
00000528  201D                              91      MOVE.L  (A5)+,D0
0000052A  21CD 0460                         92      MOVE.L  A5,TBB_EXT_PUNT
0000052E  6000 00C0                         93      BRA FIN_LEECAR
00000532                                    94    TBB_RESET:
00000532  2A78 0460                         95      MOVE.L  TBB_EXT_PUNT,A5
00000536  200D                              96      MOVE.L  A5,D0
00000538  2A78 0448                         97      MOVE.L  TBA_IN_PUNT,A5
0000053C  21CD 0460                         98      MOVE.L  A5,TBB_EXT_PUNT
00000540  6000 00AE                         99      BRA FIN_LEECAR
00000544                                   100  
00000544                                   101    REC_B:
00000544  2878 0444                        102      MOVE.L RBB_INT_PUNT,A4
00000548  2678 0440                        103      MOVE.L RBB_EXT_PUNT,A3
0000054C  B8CB                             104      CMP  A3,A4
0000054E  6700 009E                        105      BEQ VACIO
00000552  2878 043C                        106      MOVE.L RBB_FIN_PUNT,A4
00000556  528C                             107      ADD.L #1,A4
00000558  B8CB                             108      CMP A3,A4
0000055A  6700 0010                        109      BEQ RBB_RESET
0000055E  2A78 0440                        110      MOVE.L  RBB_EXT_PUNT,A5
00000562  201D                             111      MOVE.L  (A5)+,D0
00000564  21CD 0440                        112      MOVE.L  A5,RBB_EXT_PUNT
00000568  6000 0086                        113      BRA FIN_LEECAR
0000056C                                   114    RBB_RESET:
0000056C  2A78 0440                        115      MOVE.L  RBB_EXT_PUNT,A5
00000570  200D                             116      MOVE.L  A5,D0
00000572  2A78 0438                        117      MOVE.L  RBB_IN_PUNT,A5
00000576  21CD 0440                        118      MOVE.L  A5,RBB_EXT_PUNT
0000057A  6000 0074                        119      BRA FIN_LEECAR
0000057E                                   120  
0000057E                                   121    LINEA_A:
0000057E  B07C 0000                        122      CMP #$00000000,D0
00000582  6700 0002                        123      BEQ TRANS_A
00000586                                   124  
00000586                                   125    TRANS_A:
00000586  2878 0454                        126      MOVE.L TBA_INT_PUNT,A4
0000058A  2678 0450                        127      MOVE.L TBA_EXT_PUNT,A3
0000058E  B8CB                             128      CMP  A3,A4
00000590  6700 005C                        129      BEQ VACIO
00000594  2878 044C                        130      MOVE.L TBA_FIN_PUNT,A4
00000598  528C                             131      ADD.L #1,A4
0000059A  B8CB                             132      CMP A3,A4
0000059C  6700 0010                        133      BEQ TBA_RESET
000005A0  2A78 0450                        134      MOVE.L  TBA_EXT_PUNT,A5
000005A4  101D                             135      MOVE.B  (A5)+,D0
000005A6  21CD 0450                        136      MOVE.L  A5,TBA_EXT_PUNT
000005AA  6000 0044                        137      BRA FIN_LEECAR
000005AE                                   138    TBA_RESET:
000005AE  2A78 0450                        139      MOVE.L  TBA_EXT_PUNT,A5
000005B2  200D                             140      MOVE.L  A5,D0
000005B4  2A78 0448                        141      MOVE.L  TBA_IN_PUNT,A5
000005B8  21CD 0450                        142      MOVE.L  A5,TBA_EXT_PUNT
000005BC  6000 0032                        143      BRA FIN_LEECAR
000005C0                                   144  
000005C0                                   145    REC_A:
000005C0                                   146    *  MOVE.L RBA_INT_PUNT,A4
000005C0  2678 0450                        147      MOVE.L TBA_EXT_PUNT,A3
000005C4                                   148      *CMP  A3,A4
000005C4                                   149      *BEQ VACIO
000005C4  2878 044C                        150      MOVE.L TBA_FIN_PUNT,A4
000005C8  588C                             151      ADD.L #4,A4
000005CA  B8CB                             152      CMP A3,A4
000005CC  67E0                             153      BEQ TBA_RESET
000005CE  2A78 0450                        154      MOVE.L  TBA_EXT_PUNT,A5
000005D2  201D                             155      MOVE.L  (A5)+,D0
000005D4  21CD 0450                        156      MOVE.L  A5,TBA_EXT_PUNT
000005D8  6000 0016                        157      BRA FIN_LEECAR
000005DC                                   158    RBA_RESET:
000005DC  2A78 0450                        159      MOVE.L  TBA_EXT_PUNT,A5
000005E0  2015                             160      MOVE.L  (A5),D0
000005E2  2A78 0448                        161      MOVE.L  TBA_IN_PUNT,A5
000005E6  21CD 0450                        162      MOVE.L  A5,TBA_EXT_PUNT
000005EA  6000 0004                        163      BRA FIN_LEECAR
000005EE                                   164  
000005EE                                   165  
000005EE                                   166    VACIO:
000005EE  70FF                             167      MOVE.L #$ffffffff,D0
000005F0  4E75                             168    FIN_LEECAR:RTS
000005F2                                   169  
000005F2                                   170  ********************ESCCAR********************
000005F2                                   171  ESCCAR:
000005F2                                   172  
000005F2  0800 0000                        173  	         BTST #0,D0
000005F6  6700 0002                        174  	         BEQ ELINEA_A
000005FA                                   175  
000005FA                                   176  ELINEA_A:
000005FA                                   177  
000005FA  0800 0001                        178             BTST   #1,D0
000005FE                                   179  	        * BEQ EREC_A
000005FE                                   180  
000005FE                                   181  ETRANS_A:
000005FE  2A78 0454                        182      MOVE.L TBA_INT_PUNT,A5 *Se mete el puntero I en A5
00000602  2878 044C                        183      MOVE.L TBA_FIN_PUNT,A4 *Se mete el puntero FIn en A4
00000606  2678 0450                        184      MOVE.L TBA_EXT_PUNT,A3 *Se mete el puntero de E al A3
0000060A  2478 0448                        185      MOVE.L  TBA_IN_PUNT,A2 *Se mete el puntero de Principio al A2
0000060E  528C                             186      ADD.L #1,A4   *Se le añade 1 al puntero de fin
00000610  BBCC                             187      CMP.L A4,A5   *Se comparan los punteros I y F+1
00000612  538C                             188      SUB.L #1,A4   *Se restablece el valor del puntero FIn
00000614  6700 0024                        189      BEQ  AUX      *Está en la posicion auxiliar
00000618  BBCC                             190      CMPA.L A4,A5  *Se comprueba si F e I estan en la misma posicion
0000061A  6700 0036                        191      BEQ    I_FIN  *Si I y Fin son iguales salta a la etiqueta de fin
0000061E                                   192  
0000061E                                   193  I_NO_FIN:
0000061E  538B                             194      SUB.L #1,A3  *Se le resta a E una unidad
00000620  B7CD                             195      CMP.L A5,A3  *Se mira si son iguales I y E-1
00000622  528B                             196      ADD.L #1,A3  *Se restablece el valor de E
00000624  6700 0034                        197      BEQ  LLENO   *Si son iguales esta lleno
00000628                                   198  
00000628                                   199  CONTINUA:
00000628  528C                             200      ADD.L #1,A4 *Se le añade 1 al puntero de fin
0000062A  BBCC                             201      CMP.L A4,A5 *Se comparan los punteros I y F+1
0000062C  538C                             202      SUB.L #1,A4 *Se restablece el valor del puntero FIn
0000062E  6700 000A                        203      BEQ  AUX    *Está en la posicion auxiliar
00000632                                   204  
00000632                                   205  NO_AUX:
00000632  1AC1                             206    MOVE.B  D1,(A5)+           *Push del registro D1 en el buffer
00000634  21CD 0454                        207    MOVE.L  A5,TBA_INT_PUNT           *Guarda la nueva direcion del puntero
00000638  4E75                             208    RTS
0000063A                                   209  
0000063A                                   210  AUX:
0000063A  B5CB                             211      CMP.L A3,A2  *Se comprueba si E y P estan en la misma posicion
0000063C  6700 001C                        212      BEQ LLENO
00000640  1A81                             213      MOVE.B  D1,(A5)   *Push del registro D1 en el buffer
00000642  21F8 0448 0454                   214      MOVE.L  TBA_IN_PUNT,TBA_INT_PUNT  *Se Inicializa I con el valor de Principio
00000648  4E75                             215      RTS
0000064A                                   216  
0000064A                                   217  NO_LLENO:
0000064A  1AC1                             218      MOVE.B  D1,(A5)+           *Push del registro D1 en el buffer
0000064C  21CD 0454                        219      MOVE.L  A5,TBA_INT_PUNT           *Guarda la nueva direcion del puntero
00000650  4E75                             220      RTS
00000652                                   221  
00000652                                   222  I_FIN:
00000652  1AC1                             223      MOVE.B  D1,(A5)+           *Push del registro D1 en el buffer
00000654  21CD 0454                        224      MOVE.L  A5,TBA_INT_PUNT           *Guarda la nueva direcion del puntero
00000658  4E75                             225      RTS
0000065A                                   226  
0000065A                                   227  LLENO:
0000065A  70FF                             228      MOVE.L #$ffffffff,D0
0000065C  4E75                             229      RTS
0000065E                                   230  
0000065E                                   231  *PRINT
0000065E  4E75                             232  PRINT:RTS
00000660                                   233  *LINEA
00000660  4E75                             234  LINEA:RTS
00000662                                   235  *SCAN
00000662  4E75                             236  SCAN:RTS
00000664                                   237  *RTI
00000664  4E75                             238  RTI:RTS
00000666                                   239  
00000666                                   240  
00000666                                   241  *Pruebas
00000666                                   242  PRUEBA:
00000666  2878 042C                        243    MOVE.L RBA_FIN_PUNT,A4
0000066A                                   244    *MOVE.L RBB_IN_PUNT,A4
0000066A  4E75                             245    RTS
0000066C                                   246  
0000066C                                   247  *Programa Principal
0000066C  6100 FDFA                        248  INICIO: BSR INIT
00000670  7000                             249  	MOVE.L #$00000000,D0
00000672  7200                             250    MOVE.L #000000000,D1
00000674  6100 FF7C                        251    BSR ESCCAR
00000678  7201                             252    MOVE.L #$00000001,D1
0000067A  6100 FF76                        253    BSR ESCCAR
0000067E  7202                             254      MOVE.L #$00000002,D1
00000680  6100 FF70                        255    BSR ESCCAR
00000684  7203                             256      MOVE.L #$00000003,D1
00000686  6100 FF6A                        257    BSR ESCCAR
0000068A  7204                             258      MOVE.L #$00000004,D1
0000068C  6100 FF64                        259    BSR ESCCAR
00000690  7205                             260      MOVE.L #$00000005,D1
00000692  6100 FF5E                        261    BSR ESCCAR
00000696  7206                             262      MOVE.L #$00000006,D1
00000698  6100 FF58                        263    BSR ESCCAR
0000069C  7207                             264      MOVE.L #$00000007,D1
0000069E  6100 FF52                        265    BSR ESCCAR
000006A2  6100 FF4E                        266    BSR ESCCAR
000006A6  7000                             267    MOVE.L #$00000000,D0
000006A8  6100 FE50                        268    BSR LEECAR
000006AC  7209                             269      MOVE.L #$00000009,D1
000006AE  6100 FF42                        270    BSR ESCCAR
000006B2  6100 FE46                        271      BSR LEECAR
000006B6  6100 FE42                        272      BSR LEECAR
000006BA  6100 FE3E                        273      BSR LEECAR
000006BE  6100 FE3A                        274      BSR LEECAR
000006C2  6100 FE36                        275      BSR LEECAR
000006C6  6100 FE32                        276      BSR LEECAR
000006CA  6100 FE2E                        277      BSR LEECAR
000006CE  6100 FE2A                        278      BSR LEECAR
000006D2  6100 FE26                        279      BSR LEECAR
000006D6  4848                             280    BREAK

No errors detected
No warnings generated
