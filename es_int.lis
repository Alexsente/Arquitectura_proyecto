00000000                                     1  * Inicializa el SP y el PC
00000000                                     2          ORG     $0
00000000  00008000                           3          DC.L    $8000           *Pila
00000004  0000272A                           4          DC.L    INICIO          *PC
00000400                                     5          ORG     $400
00000400                                     6  
00000400                                     7  	*Buffers
00000400                                     8  BUS_RBA:DS.B 2002
00000BD2                                     9  BUS_RBB:DS.B 2002
000013A4                                    10  BUS_TBA:DS.B 2002
00001B76                                    11  BUS_TBB:DS.B 2002
00002348                                    12  
00002348                                    13  	*Punteros
00002348  00000000                          14  RBA_IN_PUNT: DC.L 0
0000234C  00000000                          15  RBA_FIN_PUNT:DC.L 0
00002350  00000000                          16  RBA_EXT_PUNT:DC.L 0
00002354  00000000                          17  RBA_INT_PUNT:DC.L 0
00002358  00000000                          18  RBB_IN_PUNT: DC.L 0
0000235C  00000000                          19  RBB_FIN_PUNT:DC.L 0
00002360  00000000                          20  RBB_EXT_PUNT:DC.L 0
00002364  00000000                          21  RBB_INT_PUNT:DC.L 0
00002368  00000000                          22  TBA_IN_PUNT: DC.L 0
0000236C  00000000                          23  TBA_FIN_PUNT:DC.L 0
00002370  00000000                          24  TBA_EXT_PUNT:DC.L 0
00002374  00000000                          25  TBA_INT_PUNT:DC.L 0
00002378  00000000                          26  TBB_IN_PUNT: DC.L 0
0000237C  00000000                          27  TBB_FIN_PUNT:DC.L 0
00002380  00000000                          28  TBB_EXT_PUNT:DC.L 0
00002384  00000000                          29  TBB_INT_PUNT:DC.L 0
00002388                                    30  
00002388                                    31  
00002388                                    32  * Definicion de equivalencias
00002388                                    33  
00002388  =00EFFC01                         34  MR1A    EQU     $effc01       * de modo A (escritura)
00002388  =00EFFC01                         35  MR2A    EQU     $effc01       * de modo A (2 escritura)
00002388  =00EFFC03                         36  SRA     EQU     $effc03       * de estado A (lectura)
00002388  =00EFFC03                         37  CSRA    EQU     $effc03       * de seleccion de reloj A (escritura)
00002388  =00EFFC05                         38  CRA     EQU     $effc05       * de control A (escritura)
00002388  =00EFFC07                         39  TBA     EQU     $effc07       * buffer transmision A (escritura)
00002388  =00EFFC07                         40  RBA     EQU     $effc07       * buffer recepcion A  (lectura)
00002388  =00EFFC17                         41  TBB     EQU     $effc17       * buffer trasmisión B
00002388  =00EFFC17                         42  RBB     EQU     $effc17       * buffer recepción B
00002388  =00EFFC09                         43  ACR     EQU     $effc09       * de control auxiliar
00002388  =00EFFC0B                         44  IMR     EQU     $effc0B       * de mascara de interrupcion A (escritura)
00002388  =00EFFC0B                         45  ISR     EQU     $effc0B       * de estado de interrupcion A (lectura)
00002388                                    46  
00002388                                    47  *INIT
00002388                                    48  INIT:
00002388  21FC 00000400 2348                49  	MOVE.L #BUS_RBA,RBA_IN_PUNT
00002390  21FC 00000400 2350                50  	MOVE.L #BUS_RBA,RBA_EXT_PUNT
00002398  21FC 00000400 2354                51  	MOVE.L #BUS_RBA,RBA_INT_PUNT
000023A0  21FC 00000400 234C                52  	MOVE.L #BUS_RBA,RBA_FIN_PUNT
000023A8  06B8 000007CF 234C                53  	ADD.L  #1999,RBA_FIN_PUNT
000023B0  21FC 00000BD2 2358                54  	MOVE.L #BUS_RBB,RBB_IN_PUNT
000023B8  21FC 00000BD2 2360                55  	MOVE.L #BUS_RBB,RBB_EXT_PUNT
000023C0  21FC 00000BD2 2364                56  	MOVE.L #BUS_RBB,RBB_INT_PUNT
000023C8  21FC 00000BD2 235C                57  	MOVE.L #BUS_RBB,RBB_FIN_PUNT
000023D0  06B8 000007CF 235C                58  	ADD.L  #1999,RBB_FIN_PUNT
000023D8  21FC 000013A4 2368                59  	MOVE.L #BUS_TBA,TBA_IN_PUNT
000023E0  21FC 000013A4 2370                60  	MOVE.L #BUS_TBA,TBA_EXT_PUNT
000023E8  21FC 000013A4 2374                61  	MOVE.L #BUS_TBA,TBA_INT_PUNT
000023F0  21FC 000013A4 236C                62  	MOVE.L #BUS_TBA,TBA_FIN_PUNT
000023F8  06B8 000007CF 236C                63  	ADD.L  #1999,TBA_FIN_PUNT
00002400  21FC 00001B76 2378                64  	MOVE.L #BUS_TBB,TBB_IN_PUNT
00002408  21FC 00001B76 2380                65  	MOVE.L #BUS_TBB,TBB_EXT_PUNT
00002410  21FC 00001B76 2384                66  	MOVE.L #BUS_TBB,TBB_INT_PUNT
00002418  21FC 00001B76 237C                67  	MOVE.L #BUS_TBB,TBB_FIN_PUNT
00002420  06B8 000007CF 237C                68  	ADD.L  #1999,TBB_FIN_PUNT
00002428  4E75                              69  	RTS
0000242A                                    70  
0000242A                                    71    *********************LEECAR**********************
0000242A                                    72  
0000242A                                    73    LEECAR:
0000242A  0800 0000                         74      BTST    #0,D0
0000242E                                    75      *BEQ LA_LINEA
0000242E                                    76  
0000242E                                    77  LB_LINEA:
0000242E  B07C 0001                         78       CMP #$00000001,D0
00002432                                    79       *BEQ LB_REC
00002432                                    80  
00002432                                    81  LB_TRANS:
00002432  2478 2378                         82       MOVE.L TBB_IN_PUNT,A2
00002436  2678 2380                         83       MOVE.L TBB_EXT_PUNT,A3
0000243A  2878 2384                         84       MOVE.L TBB_INT_PUNT,A4
0000243E  2A78 237C                         85       MOVE.L TBB_FIN_PUNT,A5
00002442  B8CB                              86       CMP  A3,A4    * E=I?
00002444  6700 00DC                         87       BEQ VACIO     * E= I, entonces buffer vacio
00002448  528D                              88       ADD.L #1,A5
0000244A  BACB                              89       CMP A3,A5     * E = F+1?
0000244C  538D                              90       SUB.L #1,A5  *Se restablece F a sus posicion original
0000244E  6700 000C                         91       BEQ TBB_RESET
00002452  101B                              92       MOVE.B  (A3)+,D0
00002454  21CB 2380                         93       MOVE.L  A3,TBB_EXT_PUNT
00002458  6000 00CA                         94       BRA FIN_LEECAR
0000245C                                    95    TBB_RESET:
0000245C  528C                              96       ADD.L #1,A4
0000245E  101A                              97       MOVE.B (A2)+,D0
00002460  21CC 2384                         98       MOVE.L A4,TBB_INT_PUNT
00002464  21CA 2380                         99       MOVE.L A2,TBB_EXT_PUNT
00002468  6000 00BA                        100       BRA FIN_LEECAR
0000246C                                   101  
0000246C                                   102  LB_REC:
0000246C  2478 2358                        103      MOVE.L RBB_IN_PUNT,A2
00002470  2678 2360                        104      MOVE.L RBB_EXT_PUNT,A3
00002474  2878 2364                        105      MOVE.L RBB_INT_PUNT,A4
00002478  2A78 235C                        106      MOVE.L RBB_FIN_PUNT,A5
0000247C  B8CB                             107      CMP  A3,A4    * E=I?
0000247E  6700 00A2                        108      BEQ VACIO     * E= I, entonces buffer vacio
00002482  528D                             109      ADD.L #1,A5
00002484  BACB                             110      CMP A3,A5     * E = F+1?
00002486  538D                             111      SUB.L #1,A5  *Se restablece F a sus posicion original
00002488  6700 000C                        112      BEQ RBB_RESET
0000248C  101B                             113      MOVE.B  (A3)+,D0
0000248E  21CB 2360                        114      MOVE.L  A3,RBB_EXT_PUNT
00002492  6000 0090                        115      BRA FIN_LEECAR
00002496                                   116  RBB_RESET:
00002496  528C                             117      ADD.L #1,A4
00002498  201A                             118      MOVE.L (A2)+,D0
0000249A  21CC 2364                        119      MOVE.L A4,RBB_INT_PUNT
0000249E  21CA 2360                        120      MOVE.L A2,RBB_EXT_PUNT
000024A2  6000 0080                        121      BRA FIN_LEECAR
000024A6                                   122  LA_LINEA:
000024A6  B07C 0000                        123      CMP #$00000000,D0
000024AA  6700 003C                        124      BEQ LA_REC
000024AE                                   125  
000024AE                                   126  LA_TRANS:
000024AE  2478 2368                        127      MOVE.L TBA_IN_PUNT,A2
000024B2  2678 2370                        128      MOVE.L TBA_EXT_PUNT,A3
000024B6  2878 2374                        129      MOVE.L TBA_INT_PUNT,A4
000024BA  2A78 236C                        130      MOVE.L TBA_FIN_PUNT,A5
000024BE  B8CB                             131      CMP  A3,A4    * E=I?
000024C0  6700 0060                        132      BEQ VACIO     * E= I, entonces buffer vacio
000024C4  528D                             133      ADD.L #1,A5
000024C6  BACB                             134      CMP A3,A5     * E = F+1?
000024C8  538D                             135      SUB.L #1,A5  *Se restablece F a sus posicion original
000024CA  6700 000C                        136      BEQ TBA_RESET
000024CE  101B                             137      MOVE.B  (A3)+,D0
000024D0  21CB 2370                        138      MOVE.L  A3,TBA_EXT_PUNT
000024D4  6000 004E                        139      BRA FIN_LEECAR
000024D8                                   140  TBA_RESET:
000024D8  528C                             141      ADD.L #1,A4
000024DA  201A                             142      MOVE.L (A2)+,D0
000024DC  21CC 2374                        143      MOVE.L A4,TBA_INT_PUNT
000024E0  21CA 2370                        144      MOVE.L A2,TBA_EXT_PUNT
000024E4  6000 003E                        145      BRA FIN_LEECAR
000024E8                                   146  LA_REC:
000024E8  2478 2348                        147      MOVE.L RBA_IN_PUNT,A2
000024EC  2678 2350                        148      MOVE.L RBA_EXT_PUNT,A3
000024F0  2878 2354                        149      MOVE.L RBA_INT_PUNT,A4
000024F4  2A78 234C                        150      MOVE.L RBA_FIN_PUNT,A5
000024F8  B8CB                             151      CMP  A3,A4    * E=I?
000024FA  6700 0026                        152      BEQ VACIO     * E= I, entonces buffer vacio
000024FE  528D                             153      ADD.L #1,A5
00002500  BACB                             154      CMP A3,A5     * E = F+1?
00002502  538D                             155      SUB.L #1,A5  *Se restablece F a sus posicion original
00002504  6700 000C                        156      BEQ RBA_RESET
00002508  101B                             157      MOVE.B  (A3)+,D0
0000250A  21CB 2350                        158      MOVE.L  A3,RBA_EXT_PUNT
0000250E  6000 0014                        159      BRA FIN_LEECAR
00002512                                   160  
00002512                                   161  RBA_RESET:
00002512  528C                             162      ADD.L #1,A4
00002514  201A                             163      MOVE.L (A2)+,D0
00002516  21CC 2354                        164      MOVE.L A4,RBA_INT_PUNT
0000251A  21CA 2350                        165      MOVE.L A2,RBA_EXT_PUNT
0000251E  6000 0004                        166      BRA FIN_LEECAR
00002522                                   167  
00002522                                   168    VACIO:
00002522  70FF                             169      MOVE.L #$ffffffff,D0
00002524  4E75                             170    FIN_LEECAR:RTS
00002526                                   171  
00002526                                   172  ********************ESCCAR********************
00002526                                   173  ESCCAR:
00002526                                   174  
00002526  0800 0000                        175      BTST #0,D0
0000252A                                   176      *BEQ EA_LINEA
0000252A                                   177  
0000252A                                   178  EB_LINEA:
0000252A                                   179  
0000252A  B07C 0001                        180      CMP #$00000001,D0
0000252E                                   181      *BEQ ESC_REC_B
0000252E                                   182  
0000252E                                   183  ESC_TRANS_B:
0000252E  2478 2378                        184      MOVE.L TBB_IN_PUNT,A2 *Se mete el puntero de Principio al A2
00002532  2678 2380                        185      MOVE.L TBB_EXT_PUNT,A3 *Se mete el puntero de E al A3
00002536  2878 2384                        186      MOVE.L TBB_INT_PUNT,A4 *Se mete el puntero I en A4
0000253A  2A78 237C                        187      MOVE.L TBB_FIN_PUNT,A5 *Se mete el puntero FIn en A5
0000253E  538B                             188      SUB.L #1,A3  *Se le resta 1 a E
00002540  B9CB                             189      CMP.L A3,A4 * I=E-1?
00002542  528B                             190      ADD.L #1,A3  *Se restablece el valor de E
00002544  6700 0128                        191      BEQ LLENO
00002548  528D                             192      ADD.L #1,A5   *Se le añade 1 al puntero de fin
0000254A  BBCC                             193      CMP.L A4,A5   *Se comparan los punteros I y F+1
0000254C  538D                             194      SUB.L #1,A5   *Se restablece el valor del puntero FIn
0000254E  6700 001A                        195      BEQ  TBB_AUX      *Está en la posicion auxiliar
00002552                                   196  
00002552                                   197  TBB_NO_AUX:
00002552  B9CB                             198      CMP.L A3,A4  *Se comparan I y E
00002554  6C00 000C                        199      BGE TBB_MAYOR
00002558  528C                             200      ADD.L #1,A4
0000255A  1881                             201      MOVE.B  D1,(A4)            *Push del registro D1 en el buffer
0000255C  21CC 2384                        202      MOVE.L  A4,TBB_INT_PUNT    *Guarda la nueva direcion del puntero
00002560  4E75                             203      RTS
00002562                                   204  
00002562                                   205  TBB_MAYOR:
00002562  18C1                             206      MOVE.B  D1,(A4)+           *Push del registro D1 en el buffer
00002564  21CC 2384                        207      MOVE.L  A4,TBB_INT_PUNT           *Guarda la nueva direcion del puntero
00002568  4E75                             208      RTS
0000256A                                   209  
0000256A                                   210  TBB_AUX:
0000256A  B5CB                             211      CMP.L A3,A2  * E=P?
0000256C  6700 0100                        212      BEQ   LLENO
00002570  2878 2378                        213      MOVE.L  TBB_IN_PUNT,A4
00002574  1881                             214      MOVE.B  D1,(A4)   *Push del registro D1 en el buffer
00002576  21CC 2384                        215      MOVE.L  A4,TBB_INT_PUNT  *Se Inicializa I con el valor de Principio
0000257A  4E75                             216      RTS
0000257C                                   217  
0000257C                                   218  ESC_REC_B:
0000257C  2878 2364                        219    MOVE.L RBB_INT_PUNT,A4 *Se mete el puntero I en A4
00002580  2A78 235C                        220    MOVE.L RBB_FIN_PUNT,A5 *Se mete el puntero FIn en A5
00002584  2678 2360                        221    MOVE.L RBB_EXT_PUNT,A3 *Se mete el puntero de E al A3
00002588  2478 2358                        222    MOVE.L RBB_IN_PUNT,A2 *Se mete el puntero de Principio al A2
0000258C  538B                             223    SUB.L #1,A3  *Se le resta 1 a E
0000258E  B9CB                             224    CMP.L A3,A4 * I=E-1?
00002590  528B                             225    ADD.L #1,A3  *Se restablece el valor de E
00002592  6700 00DA                        226    BEQ LLENO
00002596  528D                             227    ADD.L #1,A5   *Se le añade 1 al puntero de fin
00002598  BBCC                             228    CMP.L A4,A5   *Se comparan los punteros I y F+1
0000259A  538D                             229    SUB.L #1,A5   *Se restablece el valor del puntero FIn
0000259C  6700 001A                        230    BEQ  RBB_AUX      *Está en la posicion auxiliar
000025A0                                   231  
000025A0                                   232  RBB_NO_AUX:
000025A0  B9CB                             233    CMP.L A3,A4  *Se comparan I y E
000025A2  6C00 000C                        234    BGE RBB_MAYOR
000025A6  528C                             235    ADD.L #1,A4
000025A8  1881                             236    MOVE.B  D1,(A4)            *Push del registro D1 en el buffer
000025AA  21CC 2364                        237    MOVE.L  A4,RBB_INT_PUNT    *Guarda la nueva direcion del puntero
000025AE  4E75                             238    RTS
000025B0                                   239  
000025B0                                   240  RBB_MAYOR:
000025B0  18C1                             241    MOVE.B  D1,(A4)+           *Push del registro D1 en el buffer
000025B2  21CC 2364                        242    MOVE.L  A4,RBB_INT_PUNT           *Guarda la nueva direcion del puntero
000025B6  4E75                             243    RTS
000025B8                                   244  
000025B8                                   245  RBB_AUX:
000025B8  B5CB                             246    CMP.L A3,A2  * E=P?
000025BA  6700 00B2                        247    BEQ   LLENO
000025BE  2878 2358                        248    MOVE.L  RBB_IN_PUNT,A4
000025C2  1881                             249    MOVE.B  D1,(A4)   *Push del registro D1 en el buffer
000025C4  21CC 2364                        250    MOVE.L  A4,RBB_INT_PUNT  *Se Inicializa I con el valor de Principio
000025C8  4E75                             251    RTS
000025CA                                   252  
000025CA                                   253  EA_LINEA:
000025CA  B07C 0000                        254    CMP #$00000000,D0
000025CE  6700 0050                        255    BEQ EA_REC
000025D2                                   256  
000025D2                                   257  EA_TRANS:
000025D2  2878 2374                        258    MOVE.L TBA_INT_PUNT,A4 *Se mete el puntero I en A4
000025D6  2A78 236C                        259    MOVE.L TBA_FIN_PUNT,A5 *Se mete el puntero FIn en A5
000025DA  2678 2370                        260    MOVE.L TBA_EXT_PUNT,A3 *Se mete el puntero de E al A3
000025DE  2478 2368                        261    MOVE.L TBA_IN_PUNT,A2 *Se mete el puntero de Principio al A2
000025E2  538B                             262    SUB.L #1,A3  *Se le resta 1 a E
000025E4  B9CB                             263    CMP.L A3,A4 * I=E-1?
000025E6  528B                             264    ADD.L #1,A3  *Se restablece el valor de E
000025E8  6700 0084                        265    BEQ LLENO
000025EC  528D                             266    ADD.L #1,A5   *Se le añade 1 al puntero de fin
000025EE  BBCC                             267    CMP.L A4,A5   *Se comparan los punteros I y F+1
000025F0  538D                             268    SUB.L #1,A5   *Se restablece el valor del puntero FIn
000025F2  6700 001A                        269    BEQ  TBA_AUX      *Está en la posicion auxiliar
000025F6                                   270  
000025F6                                   271  TBA_NO_AUX:
000025F6  B9CB                             272    CMP.L A3,A4  *Se comparan I y E
000025F8  6C00 000C                        273    BGE TBA_MAYOR
000025FC  528C                             274    ADD.L #1,A4
000025FE  1881                             275    MOVE.B  D1,(A4)            *Push del registro D1 en el buffer
00002600  21CC 2374                        276    MOVE.L  A4,TBA_INT_PUNT    *Guarda la nueva direcion del puntero
00002604  4E75                             277    RTS
00002606                                   278  
00002606                                   279  TBA_MAYOR:
00002606  18C1                             280    MOVE.B  D1,(A4)+           *Push del registro D1 en el buffer
00002608  21CC 2374                        281    MOVE.L  A4,TBA_INT_PUNT           *Guarda la nueva direcion del puntero
0000260C  4E75                             282    RTS
0000260E                                   283  
0000260E                                   284  TBA_AUX:
0000260E  B5CB                             285    CMP.L A3,A2  * E=P?
00002610  6700 005C                        286    BEQ   LLENO
00002614  2878 2368                        287    MOVE.L  TBA_IN_PUNT,A4
00002618  1881                             288    MOVE.B  D1,(A4)   *Push del registro D1 en el buffer
0000261A  21CC 2374                        289    MOVE.L  A4,TBA_INT_PUNT  *Se Inicializa I con el valor de Principio
0000261E  4E75                             290    RTS
00002620                                   291  
00002620                                   292  EA_REC:
00002620  2878 2354                        293    MOVE.L RBA_INT_PUNT,A4 *Se mete el puntero I en A4
00002624  2A78 234C                        294    MOVE.L RBA_FIN_PUNT,A5 *Se mete el puntero FIn en A5
00002628  2678 2350                        295    MOVE.L RBA_EXT_PUNT,A3 *Se mete el puntero de E al A3
0000262C  2478 2348                        296    MOVE.L RBA_IN_PUNT,A2 *Se mete el puntero de Principio al A2
00002630  538B                             297    SUB.L #1,A3  *Se le resta 1 a E
00002632  B9CB                             298    CMP.L A3,A4 * I=E-1?
00002634  528B                             299    ADD.L #1,A3  *Se restablece el valor de E
00002636  6700 0036                        300    BEQ LLENO
0000263A  528D                             301    ADD.L #1,A5   *Se le añade 1 al puntero de fin
0000263C  BBCC                             302    CMP.L A4,A5   *Se comparan los punteros I y F+1
0000263E  538D                             303    SUB.L #1,A5   *Se restablece el valor del puntero FIn
00002640  6700 001A                        304    BEQ  RBA_AUX      *Está en la posicion auxiliar
00002644                                   305  
00002644                                   306  RBA_NO_AUX:
00002644  B9CB                             307    CMP.L A3,A4  *Se comparan I y E
00002646  6C00 000C                        308    BGE RBA_MAYOR
0000264A  528C                             309    ADD.L #1,A4
0000264C  1881                             310    MOVE.B  D1,(A4)            *Push del registro D1 en el buffer
0000264E  21CC 2354                        311    MOVE.L  A4,RBA_INT_PUNT    *Guarda la nueva direcion del puntero
00002652  4E75                             312    RTS
00002654                                   313  
00002654                                   314  RBA_MAYOR:
00002654  18C1                             315    MOVE.B  D1,(A4)+           *Push del registro D1 en el buffer
00002656  21CC 2354                        316    MOVE.L  A4,RBA_INT_PUNT           *Guarda la nueva direcion del puntero
0000265A  4E75                             317    RTS
0000265C                                   318  
0000265C                                   319  RBA_AUX:
0000265C  B5CB                             320    CMP.L A3,A2  * E=P?
0000265E  6700 000E                        321    BEQ   LLENO
00002662  2878 2348                        322    MOVE.L  RBA_IN_PUNT,A4
00002666  1881                             323    MOVE.B  D1,(A4)   *Push del registro D1 en el buffer
00002668  21CC 2354                        324    MOVE.L  A4,RBA_INT_PUNT  *Se Inicializa I con el valor de Principio
0000266C  4E75                             325    RTS
0000266E                                   326  
0000266E                                   327  LLENO:
0000266E  70FF                             328      MOVE.L #$ffffffff,D0
00002670  4E75                             329      RTS
00002672                                   330  
00002672                                   331  ********************LINEA********************
00002672                                   332  
00002672                                   333  LINEA:
00002672  0800 0000                        334    BTST #0,D0
00002676  6700 0036                        335    BEQ LINEA_A
0000267A                                   336  
0000267A                                   337  LINEA_B:
0000267A  B07C 0001                        338    CMP #$00000001,D0
0000267E  6700 0018                        339    BEQ LINEAB_REC
00002682                                   340  
00002682                                   341  LINEAB_TRANS:
00002682  2478 2378                        342    MOVE.L TBB_IN_PUNT,A2
00002686  2678 2380                        343    MOVE.L TBB_EXT_PUNT,A3 *Se mete el puntero de Principio al A2
0000268A  2878 2384                        344    MOVE.L TBB_INT_PUNT,A4 *Se mete el puntero I en A4
0000268E  2A78 237C                        345    MOVE.L TBB_FIN_PUNT,A5 *Se mete el puntero FIn en A5
00002692  4280                             346    CLR.L D0 *Contador
00002694  6000 004C                        347    BRA L_BUCLE
00002698                                   348  
00002698                                   349  LINEAB_REC:
00002698  2478 2358                        350    MOVE.L RBB_IN_PUNT,A2
0000269C  2678 2360                        351    MOVE.L RBB_EXT_PUNT,A3 *Se mete el puntero de Principio al A2
000026A0  2878 2364                        352    MOVE.L RBB_INT_PUNT,A4 *Se mete el puntero I en A4
000026A4  2A78 235C                        353    MOVE.L RBB_FIN_PUNT,A5 *Se mete el puntero FIn en A5
000026A8  4280                             354    CLR.L D0 *Contador
000026AA  6000 0036                        355    BRA L_BUCLE
000026AE                                   356  
000026AE                                   357  LINEA_A:
000026AE  B07C 0000                        358    CMP #$00000000,D0
000026B2  6700 0018                        359    BEQ LINEAA_REC
000026B6                                   360  
000026B6                                   361  LINEAA_TRANS:
000026B6  2478 2368                        362    MOVE.L TBA_IN_PUNT,A2
000026BA  2678 2370                        363    MOVE.L TBA_EXT_PUNT,A3 *Se mete el puntero de Principio al A2
000026BE  2878 2374                        364    MOVE.L TBA_INT_PUNT,A4 *Se mete el puntero I en A4
000026C2  2A78 236C                        365    MOVE.L TBA_FIN_PUNT,A5 *Se mete el puntero FIn en A5
000026C6  4280                             366    CLR.L D0 *Contador
000026C8  6000 0018                        367    BRA L_BUCLE
000026CC                                   368  
000026CC                                   369  LINEAA_REC:
000026CC  2478 2348                        370    MOVE.L RBA_IN_PUNT,A2
000026D0  2678 2350                        371    MOVE.L RBA_EXT_PUNT,A3 *Se mete el puntero de Principio al A2
000026D4  2878 2354                        372    MOVE.L RBA_INT_PUNT,A4 *Se mete el puntero I en A4
000026D8  2A78 234C                        373    MOVE.L RBA_FIN_PUNT,A5 *Se mete el puntero FIn en A5
000026DC  4280                             374    CLR.L D0 *Contador
000026DE  6000 0002                        375    BRA L_BUCLE
000026E2                                   376  
000026E2                                   377  L_BUCLE:
000026E2  4281                             378     CLR.L D1
000026E4  5280                             379     ADD.L #1,D0 *Aumenta el contador
000026E6  1213                             380     MOVE.B (A3),D1 *POP de E
000026E8  B27C 000D                        381     CMP #13,D1 *D1=13?
000026EC  6700 0034                        382     BEQ F_LINEA  *Si D1=13, SE acaba la linea
000026F0  BACB                             383     CMP A3,A5 *E=F?
000026F2  6700 0010                        384     BEQ FIN_LINEA *Si E=F, esta al final de la linea
000026F6  B6CC                             385     CMP A4,A3 *I=E?
000026F8  6700 0006                        386     BEQ L_VACIO *Si I=E, vacio
000026FC  528B                             387     ADD.L #1,A3
000026FE  60E2                             388     BRA L_BUCLE
00002700                                   389  L_VACIO:
00002700  4280                             390    CLR.L D0 *Se pone el contador a 0
00002702  4E75                             391    RTS
00002704                                   392  FIN_LINEA:
00002704  121B                             393    MOVE.B (A3)+,D1 *POP del buffer
00002706  B27C 000D                        394    CMP #13,D1 *D1=13?
0000270A  6700 0016                        395    BEQ F_LINEA *Fin de la linea
0000270E  528D                             396    ADD.L #1,A5
00002710  BACC                             397    CMP A4,A5
00002712  538D                             398    SUB.L #1,A5
00002714  6600 0008                        399    BNE L_RESET
00002718  4280                             400    CLR.L D0 *D1!=13, no es una linea, por tanto contador=0
0000271A  6000 0006                        401    BRA F_LINEA
0000271E                                   402  L_RESET:
0000271E  264A                             403    MOVE.L A2,A3
00002720  60C0                             404    BRA L_BUCLE
00002722  4E75                             405  F_LINEA: RTS
00002724                                   406  
00002724                                   407  *PRINT
00002724  4E75                             408  PRINT:RTS
00002726                                   409  *SCAN
00002726  4E75                             410  SCAN:RTS
00002728                                   411  
00002728                                   412  *RTI
00002728  4E75                             413  RTI:RTS
0000272A                                   414  
0000272A                                   415  *Pruebas
0000272A                                   416  
0000272A                                   417  *Programa Principal
0000272A                                   418  INICIO:
0000272A                                   419  *Programa Principal
0000272A                                   420  INICIO:
0000272A  6100 FC5C                        421     BSR INIT
0000272E  4280                             422     CLR.L D0
00002730  4281                             423     CLR.L D1
00002732  4283                             424     CLR.L D3
00002734                                   425  B1:
00002734  5281                             426     ADD.L #1,D1
00002736  5283                             427     ADD.L #1,D3
00002738  B27C 000A                        428     CMP  #10,D1
0000273C  6600 0004                        429     BNE CON_1
00002740  4281                             430     CLR.L D1
00002742                                   431  CON_1:
00002742  6100 FDE2                        432     BSR ESCCAR
00002746  B67C 07D0                        433     CMP #2000,D3
0000274A  66E8                             434     BNE B1
0000274C                                   435  
0000274C  4283                             436     CLR.L D3
0000274E                                   437  
0000274E                                   438  B2:
0000274E  5283                             439    ADD.L #1,D3
00002750  6100 FCD8                        440    BSR LEECAR
00002754  B67C 000A                        441    CMP #10,D3
00002758  66F4                             442    BNE B2
0000275A                                   443  
0000275A  4283                             444    CLR.L D3
0000275C                                   445  
0000275C                                   446  B4:
0000275C  5281                             447    ADD.L #1,D1
0000275E  5283                             448    ADD.L #1,D3
00002760  B27C 000A                        449    CMP  #10,D1
00002764  6600 0004                        450    BNE CON_4
00002768  4281                             451    CLR.L D1
0000276A                                   452  CON_4:
0000276A  6100 FDBA                        453    BSR ESCCAR
0000276E  B67C 000A                        454    CMP #10,D3
00002772  66E8                             455    BNE B4
00002774                                   456  
00002774  4283                             457    CLR.L D3
00002776                                   458  
00002776                                   459    B3:
00002776  5283                             460    ADD.L #1,D3
00002778  6100 FCB0                        461    BSR LEECAR
0000277C  B67C 07CF                        462    CMP #1999,D3
00002780  66F4                             463    BNE B3
00002782  6100 FCA6                        464    BSR LEECAR
00002786  6100 FCA2                        465    BSR LEECAR
0000278A  4848                             466     BREAK

No errors detected
No warnings generated
